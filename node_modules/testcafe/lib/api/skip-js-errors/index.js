"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.prepareSkipJsErrorsOptions = exports.ensureSkipJsErrorsCallbackWrapped = exports.isSkipJsErrorsOptionsObject = exports.isSkipJsErrorsCallbackWithOptionsObject = void 0;
const make_reg_exp_1 = require("../../utils/make-reg-exp");
const client_function_builder_1 = __importDefault(require("../../client-functions/client-function-builder"));
function depsToJsonWithRegExp(deps) {
    return `{
        stack: ${deps.stack}, 
        pageUrl: ${deps.pageUrl},
        message: ${deps.message}, 
    }`;
}
function getSkipJSErrorsObjectFunction(deps, proxyless) {
    const dependencies = proxyless ? depsToJsonWithRegExp(deps) : 'deps';
    return `
        let { stack, pageUrl, message } = ${dependencies};

        return stack.test(err.stack) && pageUrl.test(err.pageUrl) && message.test(err.message);
    `;
}
function getSkipJSErrorsDependenciesFunction({ fn, dependencies }) {
    let varDeclaration = '';
    if (dependencies)
        varDeclaration = `const { ${Object.keys(dependencies).join(', ')} } = ${JSON.stringify(dependencies)};`;
    return `
        ${varDeclaration}
        
        return (${fn.toString()})(err);
    `;
}
function isSkipJsErrorsCallbackWithOptionsObject(obj) {
    return !!obj && typeof obj === 'object' && 'fn' in obj;
}
exports.isSkipJsErrorsCallbackWithOptionsObject = isSkipJsErrorsCallbackWithOptionsObject;
function isSkipJsErrorsOptionsObject(obj) {
    return !!obj && typeof obj === 'object' && !isSkipJsErrorsCallbackWithOptionsObject(obj);
}
exports.isSkipJsErrorsOptionsObject = isSkipJsErrorsOptionsObject;
function ensureSkipJsErrorsCallbackWrapped(options, dependencies = {}) {
    if (typeof options === 'function')
        return wrapSkipJsErrorsCallback(options, dependencies);
    return options;
}
exports.ensureSkipJsErrorsCallbackWrapped = ensureSkipJsErrorsCallbackWrapped;
function wrapSkipJsErrorsCallback(options, dependencies) {
    return { fn: options, dependencies };
}
function prepareSkipJsErrorsOptions(options, proxyless) {
    options = ensureSkipJsErrorsCallbackWrapped(options);
    if (isSkipJsErrorsCallbackWithOptionsObject(options))
        return createSkipJsErrorsCallbackFunction(options, proxyless);
    if (isSkipJsErrorsOptionsObject(options))
        return createSkipJsErrorsObjectFunction(prepareOptionsObject(options), proxyless);
    return options;
}
exports.prepareSkipJsErrorsOptions = prepareSkipJsErrorsOptions;
function createSkipJsErrorsObjectFunction(deps, proxyless) {
    deps.message = deps.message || new RegExp('');
    deps.stack = deps.stack || new RegExp('');
    deps.pageUrl = deps.pageUrl || new RegExp('');
    const func = new Function('err', getSkipJSErrorsObjectFunction(deps, proxyless));
    if (proxyless)
        return func;
    const callbackWrapper = wrapSkipJsErrorsCallback(func, { deps });
    return createSkipJsErrorsCallbackFunction(callbackWrapper, false);
}
function createSkipJsErrorsCallbackFunction({ fn, dependencies }, proxyless) {
    if (proxyless)
        return new Function('err', getSkipJSErrorsDependenciesFunction({ fn, dependencies }));
    const methodName = 'skipJsErrors handler';
    const options = { dependencies };
    return new client_function_builder_1.default(fn, options, {
        instantiation: methodName,
        execution: methodName,
    }).getCommand();
}
function prepareOptionsObject(opts) {
    opts.message = (0, make_reg_exp_1.parseRegExpString)(opts.message);
    opts.stack = (0, make_reg_exp_1.parseRegExpString)(opts.stack);
    opts.pageUrl = (0, make_reg_exp_1.parseRegExpString)(opts.pageUrl);
    return opts;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvYXBpL3NraXAtanMtZXJyb3JzL2luZGV4LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7OztBQUdBLDJEQUE2RDtBQUU3RCw2R0FBbUY7QUFFbkYsU0FBUyxvQkFBb0IsQ0FBRSxJQUErQjtJQUMxRCxPQUFPO2lCQUNNLElBQUksQ0FBQyxLQUFLO21CQUNSLElBQUksQ0FBQyxPQUFPO21CQUNaLElBQUksQ0FBQyxPQUFPO01BQ3pCLENBQUM7QUFDUCxDQUFDO0FBRUQsU0FBUyw2QkFBNkIsQ0FBRSxJQUErQixFQUFFLFNBQWtCO0lBQ3ZGLE1BQU0sWUFBWSxHQUFHLFNBQVMsQ0FBQyxDQUFDLENBQUMsb0JBQW9CLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxDQUFDLE1BQU0sQ0FBQztJQUVyRSxPQUFPOzRDQUNpQyxZQUFZOzs7S0FHbkQsQ0FBQztBQUNOLENBQUM7QUFFRCxTQUFTLG1DQUFtQyxDQUFFLEVBQUUsRUFBRSxFQUFFLFlBQVksRUFBeUM7SUFDckcsSUFBSSxjQUFjLEdBQUcsRUFBRSxDQUFDO0lBRXhCLElBQUksWUFBWTtRQUNaLGNBQWMsR0FBRyxXQUFXLE1BQU0sQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxRQUFRLElBQUksQ0FBQyxTQUFTLENBQUMsWUFBWSxDQUFDLEdBQUcsQ0FBQztJQUU1RyxPQUFPO1VBQ0QsY0FBYzs7a0JBRU4sRUFBRSxDQUFDLFFBQVEsRUFBRTtLQUMxQixDQUFDO0FBQ04sQ0FBQztBQUVELFNBQWdCLHVDQUF1QyxDQUFFLEdBQVk7SUFDakUsT0FBTyxDQUFDLENBQUMsR0FBRyxJQUFJLE9BQU8sR0FBRyxLQUFLLFFBQVEsSUFBSSxJQUFJLElBQUksR0FBRyxDQUFDO0FBQzNELENBQUM7QUFGRCwwRkFFQztBQUVELFNBQWdCLDJCQUEyQixDQUFFLEdBQVk7SUFDckQsT0FB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T0FBTyxJQUFJLENBQUM7QUFDaEIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gICAgRGljdGlvbmFyeSwgU2tpcEpzRXJyb3JzQ2FsbGJhY2ssIFNraXBKc0Vycm9yc0NhbGxiYWNrV2l0aE9wdGlvbnNPYmplY3QsIFNraXBKc0Vycm9yc09wdGlvbnNPYmplY3QsXG59IGZyb20gJy4uLy4uL2NvbmZpZ3VyYXRpb24vaW50ZXJmYWNlcyc7XG5pbXBvcnQgeyBwYXJzZVJlZ0V4cFN0cmluZyB9IGZyb20gJy4uLy4uL3V0aWxzL21ha2UtcmVnLWV4cCc7XG5pbXBvcnQgeyBFeGVjdXRlQ2xpZW50RnVuY3Rpb25Db21tYW5kIH0gZnJvbSAnLi4vLi4vdGVzdC1ydW4vY29tbWFuZHMvb2JzZXJ2YXRpb24nO1xuaW1wb3J0IENsaWVudEZ1bmN0aW9uQnVpbGRlciBmcm9tICcuLi8uLi9jbGllbnQtZnVuY3Rpb25zL2NsaWVudC1mdW5jdGlvbi1idWlsZGVyJztcblxuZnVuY3Rpb24gZGVwc1RvSnNvbldpdGhSZWdFeHAgKGRlcHM6IFNraXBKc0Vycm9yc09wdGlvbnNPYmplY3QpOiBzdHJpbmcge1xuICAgIHJldHVybiBge1xuICAgICAgICBzdGFjazogJHtkZXBzLnN0YWNrfSwgXG4gICAgICAgIHBhZ2VVcmw6ICR7ZGVwcy5wYWdlVXJsfSxcbiAgICAgICAgbWVzc2FnZTogJHtkZXBzLm1lc3NhZ2V9LCBcbiAgICB9YDtcbn1cblxuZnVuY3Rpb24gZ2V0U2tpcEpTRXJyb3JzT2JqZWN0RnVuY3Rpb24gKGRlcHM6IFNraXBKc0Vycm9yc09wdGlvbnNPYmplY3QsIHByb3h5bGVzczogYm9vbGVhbik6IHN0cmluZyB7XG4gICAgY29uc3QgZGVwZW5kZW5jaWVzID0gcHJveHlsZXNzID8gZGVwc1RvSnNvbldpdGhSZWdFeHAoZGVwcykgOiAnZGVwcyc7XG5cbiAgICByZXR1cm4gYFxuICAgICAgICBsZXQgeyBzdGFjaywgcGFnZVVybCwgbWVzc2FnZSB9ID0gJHtkZXBlbmRlbmNpZXN9O1xuXG4gICAgICAgIHJldHVybiBzdGFjay50ZXN0KGVyci5zdGFjaykgJiYgcGFnZVVybC50ZXN0KGVyci5wYWdlVXJsKSAmJiBtZXNzYWdlLnRlc3QoZXJyLm1lc3NhZ2UpO1xuICAgIGA7XG59XG5cbmZ1bmN0aW9uIGdldFNraXBKU0Vycm9yc0RlcGVuZGVuY2llc0Z1bmN0aW9uICh7IGZuLCBkZXBlbmRlbmNpZXMgfTogU2tpcEpzRXJyb3JzQ2FsbGJhY2tXaXRoT3B0aW9uc09iamVjdCk6IHN0cmluZyB7XG4gICAgbGV0IHZhckRlY2xhcmF0aW9uID0gJyc7XG5cbiAgICBpZiAoZGVwZW5kZW5jaWVzKVxuICAgICAgICB2YXJEZWNsYXJhdGlvbiA9IGBjb25zdCB7ICR7T2JqZWN0LmtleXMoZGVwZW5kZW5jaWVzKS5qb2luKCcsICcpfSB9ID0gJHtKU09OLnN0cmluZ2lmeShkZXBlbmRlbmNpZXMpfTtgO1xuXG4gICAgcmV0dXJuIGBcbiAgICAgICAgJHt2YXJEZWNsYXJhdGlvbn1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiAoJHtmbi50b1N0cmluZygpfSkoZXJyKTtcbiAgICBgO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNTa2lwSnNFcnJvcnNDYWxsYmFja1dpdGhPcHRpb25zT2JqZWN0IChvYmo6IHVua25vd24pOiBvYmogaXMgU2tpcEpzRXJyb3JzQ2FsbGJhY2tXaXRoT3B0aW9uc09iamVjdCB7XG4gICAgcmV0dXJuICEhb2JqICYmIHR5cGVvZiBvYmogPT09ICdvYmplY3QnICYmICdmbicgaW4gb2JqO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNTa2lwSnNFcnJvcnNPcHRpb25zT2JqZWN0IChvYmo6IHVua25vd24pOiBvYmogaXMgU2tpcEpzRXJyb3JzT3B0aW9uc09iamVjdCB7XG4gICAgcmV0dXJuICEhb2JqICYmIHR5cGVvZiBvYmogPT09ICdvYmplY3QnICYmICFpc1NraXBKc0Vycm9yc0NhbGxiYWNrV2l0aE9wdGlvbnNPYmplY3Qob2JqKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGVuc3VyZVNraXBKc0Vycm9yc0NhbGxiYWNrV3JhcHBlZCAob3B0aW9uczogYm9vbGVhbiB8IFNraXBKc0Vycm9yc09wdGlvbnNPYmplY3QgfCBTa2lwSnNFcnJvcnNDYWxsYmFjayB8IFNraXBKc0Vycm9yc0NhbGxiYWNrV2l0aE9wdGlvbnNPYmplY3QsIGRlcGVuZGVuY2llczogRGljdGlvbmFyeTxhbnk+ID0ge30pOiBTa2lwSnNFcnJvcnNPcHRpb25zT2JqZWN0IHwgU2tpcEpzRXJyb3JzQ2FsbGJhY2tXaXRoT3B0aW9uc09iamVjdCB8IGJvb2xlYW4ge1xuICAgIGlmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ2Z1bmN0aW9uJylcbiAgICAgICAgcmV0dXJuIHdyYXBTa2lwSnNFcnJvcnNDYWxsYmFjayhvcHRpb25zLCBkZXBlbmRlbmNpZXMpO1xuXG4gICAgcmV0dXJuIG9wdGlvbnM7XG59XG5cbmZ1bmN0aW9uIHdyYXBTa2lwSnNFcnJvcnNDYWxsYmFjayAob3B0aW9uczogU2tpcEpzRXJyb3JzQ2FsbGJhY2ssIGRlcGVuZGVuY2llczogRGljdGlvbmFyeTxhbnk+KTogU2tpcEpzRXJyb3JzQ2FsbGJhY2tXaXRoT3B0aW9uc09iamVjdCB7XG4gICAgcmV0dXJuIHsgZm46IG9wdGlvbnMsIGRlcGVuZGVuY2llcyB9O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcHJlcGFyZVNraXBKc0Vycm9yc09wdGlvbnMgKG9wdGlvbnM6IGJvb2xlYW4gfCBTa2lwSnNFcnJvcnNPcHRpb25zT2JqZWN0IHwgU2tpcEpzRXJyb3JzQ2FsbGJhY2sgfCBTa2lwSnNFcnJvcnNDYWxsYmFja1dpdGhPcHRpb25zT2JqZWN0LCBwcm94eWxlc3M6IGJvb2xlYW4pOiBib29sZWFuIHwgRXhlY3V0ZUNsaWVudEZ1bmN0aW9uQ29tbWFuZCB8IFNraXBKc0Vycm9yc0NhbGxiYWNrIHtcbiAgICBvcHRpb25zID0gZW5zdXJlU2tpcEpzRXJyb3JzQ2FsbGJhY2tXcmFwcGVkKG9wdGlvbnMpO1xuXG4gICAgaWYgKGlzU2tpcEpzRXJyb3JzQ2FsbGJhY2tXaXRoT3B0aW9uc09iamVjdChvcHRpb25zKSlcbiAgICAgICAgcmV0dXJuIGNyZWF0ZVNraXBKc0Vycm9yc0NhbGxiYWNrRnVuY3Rpb24ob3B0aW9ucywgcHJveHlsZXNzKTtcblxuICAgIGlmIChpc1NraXBKc0Vycm9yc09wdGlvbnNPYmplY3Qob3B0aW9ucykpXG4gICAgICAgIHJldHVybiBjcmVhdGVTa2lwSnNFcnJvcnNPYmplY3RGdW5jdGlvbihwcmVwYXJlT3B0aW9uc09iamVjdChvcHRpb25zKSwgcHJveHlsZXNzKTtcblxuICAgIHJldHVybiBvcHRpb25zO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVTa2lwSnNFcnJvcnNPYmplY3RGdW5jdGlvbiAoZGVwczogU2tpcEpzRXJyb3JzT3B0aW9uc09iamVjdCwgcHJveHlsZXNzOiBib29sZWFuKTogRXhlY3V0ZUNsaWVudEZ1bmN0aW9uQ29tbWFuZCB8IFNraXBKc0Vycm9yc0NhbGxiYWNrIHtcbiAgICBkZXBzLm1lc3NhZ2UgPSBkZXBzLm1lc3NhZ2UgfHwgbmV3IFJlZ0V4cCgnJyk7XG4gICAgZGVwcy5zdGFjayAgID0gZGVwcy5zdGFjayB8fCBuZXcgUmVnRXhwKCcnKTtcbiAgICBkZXBzLnBhZ2VVcmwgPSBkZXBzLnBhZ2VVcmwgfHwgbmV3IFJlZ0V4cCgnJyk7XG5cbiAgICBjb25zdCBmdW5jID0gbmV3IEZ1bmN0aW9uKCdlcnInLCBnZXRTa2lwSlNFcnJvcnNPYmplY3RGdW5jdGlvbihkZXBzLCBwcm94eWxlc3MpKSBhcyBTa2lwSnNFcnJvcnNDYWxsYmFjaztcblxuICAgIGlmIChwcm94eWxlc3MpXG4gICAgICAgIHJldHVybiBmdW5jO1xuXG4gICAgY29uc3QgY2FsbGJhY2tXcmFwcGVyID0gd3JhcFNraXBKc0Vycm9yc0NhbGxiYWNrKGZ1bmMsIHsgZGVwcyB9KTtcblxuICAgIHJldHVybiBjcmVhdGVTa2lwSnNFcnJvcnNDYWxsYmFja0Z1bmN0aW9uKGNhbGxiYWNrV3JhcHBlciwgZmFsc2UpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVTa2lwSnNFcnJvcnNDYWxsYmFja0Z1bmN0aW9uICh7IGZuLCBkZXBlbmRlbmNpZXMgfTogU2tpcEpzRXJyb3JzQ2FsbGJhY2tXaXRoT3B0aW9uc09iamVjdCwgcHJveHlsZXNzOiBib29sZWFuKTogRXhlY3V0ZUNsaWVudEZ1bmN0aW9uQ29tbWFuZCB8IFNraXBKc0Vycm9yc0NhbGxiYWNrIHtcbiAgICBpZiAocHJveHlsZXNzKVxuICAgICAgICByZXR1cm4gbmV3IEZ1bmN0aW9uKCdlcnInLCBnZXRTa2lwSlNFcnJvcnNEZXBlbmRlbmNpZXNGdW5jdGlvbih7IGZuLCBkZXBlbmRlbmNpZXMgfSkpIGFzIFNraXBKc0Vycm9yc0NhbGxiYWNrO1xuXG4gICAgY29uc3QgbWV0aG9kTmFtZSA9ICdza2lwSnNFcnJvcnMgaGFuZGxlcic7XG4gICAgY29uc3Qgb3B0aW9ucyAgICA9IHsgZGVwZW5kZW5jaWVzIH07XG5cbiAgICByZXR1cm4gbmV3IENsaWVudEZ1bmN0aW9uQnVpbGRlcihmbiwgb3B0aW9ucywge1xuICAgICAgICBpbnN0YW50aWF0aW9uOiBtZXRob2ROYW1lLFxuICAgICAgICBleGVjdXRpb246ICAgICBtZXRob2ROYW1lLFxuICAgIH0pLmdldENvbW1hbmQoKTtcbn1cblxuZnVuY3Rpb24gcHJlcGFyZU9wdGlvbnNPYmplY3QgKG9wdHM6IFNraXBKc0Vycm9yc09wdGlvbnNPYmplY3QpOiBTa2lwSnNFcnJvcnNPcHRpb25zT2JqZWN0IHtcbiAgICBvcHRzLm1lc3NhZ2UgPSBwYXJzZVJlZ0V4cFN0cmluZyhvcHRzLm1lc3NhZ2UpO1xuICAgIG9wdHMuc3RhY2sgICA9IHBhcnNlUmVnRXhwU3RyaW5nKG9wdHMuc3RhY2spO1xuICAgIG9wdHMucGFnZVVybCA9IHBhcnNlUmVnRXhwU3RyaW5nKG9wdHMucGFnZVVybCk7XG5cbiAgICByZXR1cm4gb3B0cztcbn1cbiJdfQ==