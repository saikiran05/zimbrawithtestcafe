"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const api_base_1 = __importDefault(require("../api-base"));
const async_event_emitter_1 = __importDefault(require("../../utils/async-event-emitter"));
const PROXYLESS_STORAGE_BINDING = 'PROXYLESS_STORAGE_BINDING';
class SessionStorage extends api_base_1.default {
    constructor(browserId, client) {
        super(browserId, client);
        this.sessionStorage = '';
        this._eventEmitter = new async_event_emitter_1.default();
    }
    on(eventName, listener) {
        return this._eventEmitter.on(eventName, listener);
    }
    async init() {
        await this._client.Runtime.addBinding({ name: PROXYLESS_STORAGE_BINDING });
        await this._client.Runtime.on('bindingCalled', (event) => {
            if (event.name === 'PROXYLESS_STORAGE_BINDING') {
                this.sessionStorage = event.payload;
                this._eventEmitter.emit('contextStorageModified', this.sessionStorage);
            }
        });
    }
}
exports.default = SessionStorage;
module.exports = exports.default;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvcHJveHlsZXNzL3Nlc3Npb24tc3RvcmFnZS9pbmRleC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUVBLDJEQUEyQztBQUUzQywwRkFBZ0U7QUFHaEUsTUFBTSx5QkFBeUIsR0FBRywyQkFBMkIsQ0FBQztBQUU5RCxNQUFxQixjQUFlLFNBQVEsa0JBQWdCO0lBSXhELFlBQWEsU0FBaUIsRUFBRSxNQUFtQjtRQUMvQyxLQUFLLENBQUMsU0FBUyxFQUFFLE1BQU0sQ0FBQyxDQUFDO1FBRXpCLElBQUksQ0FBQyxjQUFjLEdBQUcsRUFBRSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSw2QkFBaUIsRUFBRSxDQUFDO0lBQ2pELENBQUM7SUFFTSxFQUFFLENBQUUsU0FBaUIsRUFBRSxRQUFrQztRQUM1RCxPQUFPLElBQUksQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxRQUFRLENBQUMsQ0FBQztJQUN0RCxDQUFDO0lBRU0sS0FBSyxDQUFDLElBQUk7UUFDYixNQUFNLElBQUksQ0FBQyxPQUFPLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQyxFQUFFLElBQUksRUFBRSx5QkFBeUIsRUFBRSxDQUFDLENBQUM7UUFFM0UsTUFBTSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsZUFBZSxFQUFFLENBQUMsS0FBeUIsRUFBRSxFQUFFO1lBQ3pFLElBQUksS0FBSyxDQUFDLElBQUksS0FBSywyQkFBMkIsRUFBRTtnQkFDNUMsSUFBSSxDQUFDLGNBQWMsR0FBRyxLQUFLLENBQUMsT0FBTyxDQUFDO2dCQUVwQyxJQUFJLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyx3QkFBd0IsRUFBRSxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7YUFDMUU7UUFDTCxDQUFDLENBQUMsQ0FBQztJQUNQLENBQUM7Q0FDSjtBQTFCRCxpQ0EwQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBQcm90b2NvbEFwaSB9IGZyb20gJ2Nocm9tZS1yZW1vdGUtaW50ZXJmYWNlJztcbmltcG9ydCBQcm90b2NvbCBmcm9tICdkZXZ0b29scy1wcm90b2NvbCc7XG5pbXBvcnQgUHJveHlsZXNzQXBpQmFzZSBmcm9tICcuLi9hcGktYmFzZSc7XG5pbXBvcnQgQmluZGluZ0NhbGxlZEV2ZW50ID0gUHJvdG9jb2wuUnVudGltZS5CaW5kaW5nQ2FsbGVkRXZlbnQ7XG5pbXBvcnQgQXN5bmNFdmVudEVtaXR0ZXIgZnJvbSAnLi4vLi4vdXRpbHMvYXN5bmMtZXZlbnQtZW1pdHRlcic7XG5pbXBvcnQgRW1pdHRlcnkgZnJvbSAnZW1pdHRlcnknO1xuXG5jb25zdCBQUk9YWUxFU1NfU1RPUkFHRV9CSU5ESU5HID0gJ1BST1hZTEVTU19TVE9SQUdFX0JJTkRJTkcnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBTZXNzaW9uU3RvcmFnZSBleHRlbmRzIFByb3h5bGVzc0FwaUJhc2Uge1xuICAgIHB1YmxpYyBzZXNzaW9uU3RvcmFnZTogc3RyaW5nO1xuICAgIHByaXZhdGUgX2V2ZW50RW1pdHRlcjogQXN5bmNFdmVudEVtaXR0ZXI7XG5cbiAgICBjb25zdHJ1Y3RvciAoYnJvd3NlcklkOiBzdHJpbmcsIGNsaWVudDogUHJvdG9jb2xBcGkpIHtcbiAgICAgICAgc3VwZXIoYnJvd3NlcklkLCBjbGllbnQpO1xuXG4gICAgICAgIHRoaXMuc2Vzc2lvblN0b3JhZ2UgPSAnJztcbiAgICAgICAgdGhpcy5fZXZlbnRFbWl0dGVyID0gbmV3IEFzeW5jRXZlbnRFbWl0dGVyKCk7XG4gICAgfVxuXG4gICAgcHVibGljIG9uIChldmVudE5hbWU6IHN0cmluZywgbGlzdGVuZXI6IChldmVudERhdGE/OiBhbnkpID0+IGFueSk6IEVtaXR0ZXJ5LlVuc3Vic2NyaWJlRm4ge1xuICAgICAgICByZXR1cm4gdGhpcy5fZXZlbnRFbWl0dGVyLm9uKGV2ZW50TmFtZSwgbGlzdGVuZXIpO1xuICAgIH1cblxuICAgIHB1YmxpYyBhc3luYyBpbml0ICgpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICAgICAgYXdhaXQgdGhpcy5fY2xpZW50LlJ1bnRpbWUuYWRkQmluZGluZyh7IG5hbWU6IFBST1hZTEVTU19TVE9SQUdFX0JJTkRJTkcgfSk7XG5cbiAgICAgICAgYXdhaXQgdGhpcy5fY2xpZW50LlJ1bnRpbWUub24oJ2JpbmRpbmdDYWxsZWQnLCAoZXZlbnQ6IEJpbmRpbmdDYWxsZWRFdmVudCkgPT4ge1xuICAgICAgICAgICAgaWYgKGV2ZW50Lm5hbWUgPT09ICdQUk9YWUxFU1NfU1RPUkFHRV9CSU5ESU5HJykge1xuICAgICAgICAgICAgICAgIHRoaXMuc2Vzc2lvblN0b3JhZ2UgPSBldmVudC5wYXlsb2FkO1xuXG4gICAgICAgICAgICAgICAgdGhpcy5fZXZlbnRFbWl0dGVyLmVtaXQoJ2NvbnRleHRTdG9yYWdlTW9kaWZpZWQnLCB0aGlzLnNlc3Npb25TdG9yYWdlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxufVxuIl19